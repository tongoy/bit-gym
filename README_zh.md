# 使用说明

```bit_gym.py```是一个在早上7点0分1秒，能够自动帮你预约**北京理工大学中关村校区体育馆羽毛球场地**的脚本。

[预约系统](http://gym.dazuiwl.cn/h5/#/pages/login/login)在预约页面上提示了**使用脚本预约场地将会封禁账号**。经过测试发现，预约系统**目前只会封禁IP地址**，**但不能保证账号一定是安全的**。IP地址被封禁后，只需要更换IP地址就可以重新使用该脚本。



## 1. 环境要求

该脚本在```Windows 10+Python 3.8.2+Chrome 101.0.4951.54```环境下测试无误。

运行该脚本，需要安装以下软件：
- Python3.8+，和Python库包括：
  - requests
  - datetime
  - selenium
- Google Chrome浏览器
- ChromeDriver。从[这里](https://chromedriver.chromium.org/downloads)或[这里](https://chromedriver.storage.googleapis.com/index.html)下载Google Chrome浏览器对应版本的ChromeDriver，具体步骤可以参见[这篇博客](https://zhuanlan.zhihu.com/p/110274934)。下载解压后，将exe程序放在该脚本同一目录下。



## 2. 使用方法

### 2.1 前言

学校这学期开通体育馆场地线上预约系统后，全校13个羽毛球场地变得更加一场难求，体育馆服务器每早7点日常瘫痪。
为此，写下了这个能够快速自动抢订场地的脚本。

该脚本分为**两个阶段**执行，第一个阶段包括登录学校账号并输入想要预约的场地和时间信息。第二个阶段包括预订场地和支付订单。脚本分为两个阶段执行是为了避免07:00前服务器瘫痪导致无法登录学校账号。整个过程以命令行交互的方式进行。

因为只有羽毛球场地供不应求，所以以下只以羽毛球为例介绍如何使用该脚本。乒乓球和网球同理。



### 2.2 第一阶段（preliminary）

线上预约系统规定可以预约当日和第二天的场地，预约时间为07:00-23:30。
对于羽毛球，只需要考虑预约第二天的场地（因为不能退场，当天场地肯定已经没了）。线上预约系统会在凌晨00:00发布第二天体育馆空余场地的信息，所以第一阶段需要在凌晨00:00-07:00前执行。由于第一阶段也需要一定时间完成，所以推荐在00:00之后（而不是07:00左右服务器高峰期时）执行。

在命令行中输入```python bit_gym.py```执行脚本，输入`0`表示进入第一阶段。后续操作根据命令行提示完成。在输入想要预约的场地和时间段时，需要根据命令行中给出的相应id值，输入预约场地和时间段对应的id整数值（一次最多预约一个场地两个时间段）。

这一阶段完成后，该脚本会将用户信息和输入的场地信息记录在当前目录下的```bit_gym.json```文件中，因此电脑可以关机。



### 2.3 第二阶段（reservation）

在早上07:00前打开电脑并在命令行中输入```python bit_gym.py```执行脚本，输入`1`表示进入第二阶段。该脚本会读取当前目录下```bit_gym.json```文件中的信息，然后显示倒计时，并在07:00:01时（让手动订场的人1秒钟）提交预约请求。由于此时是服务器高峰期，因此可能会出现```502```错误，但脚本会循环重新提交预约请求，直到预约成功或失败时停止。预约成功后命令行会输出```创建成功```。

由于服务器高峰期时无法（在电脑或手机上）手动打开支付订单页面，且场地会因未支付订单在15分钟后自动取消而释放，因此需要脚本能够自动跳转到支付订单页面。该脚本会在预约成功后，将订单等相关信息保存在当前目录的```bit_pay.html```文件中，并自动调用默认浏览器打开该文件（也可以手动双击打开该文件）跳转至支付订单页面。

**注意：为了避免预约失败（大家都用脚本预约场地时），可以在多个不同的目录下复制并运行该脚本，从而预约多个场地多个时间段。**






